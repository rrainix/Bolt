cmake_minimum_required(VERSION 3.23)

project(BoltCore LANGUAGES CXX)

# === C++20 ===
set(CMAKE_CXX_STANDARD 20)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# === Quellen & Public-Header erfassen ===
file(GLOB_RECURSE CORE_SRCS    "${CMAKE_CURRENT_SOURCE_DIR}/src/*.cpp")
file(GLOB_RECURSE CORE_HEADERS "${CMAKE_CURRENT_SOURCE_DIR}/include/*.hpp")

# === Static Library definieren ===
add_library(BoltCore STATIC ${CORE_SRCS})

# === Öffentliche & private Include-Pfade ===
target_include_directories(BoltCore
  PUBLIC
    $<BUILD_INTERFACE:${CMAKE_CURRENT_SOURCE_DIR}/include>
    $<INSTALL_INTERFACE:include>
    $<BUILD_INTERFACE:${CMAKE_SOURCE_DIR}/Vendor/External/Include/>
  PRIVATE
    ${CMAKE_CURRENT_SOURCE_DIR}/src
)

# === Precompiled Header (portabel, CMake managed) ===
# CMake kümmert sich um /Yc, /Yu und pro-Config-Dateien; dein Code kann weiterhin
# einfach #include "Bolt/btpch.hpp" benutzen.
target_precompile_headers(BoltCore PRIVATE
  "${CMAKE_CURRENT_SOURCE_DIR}/include/Bolt/btpch.hpp")

# === MSVC: einheitliches Debug-Info-Format erzwingen (verhindert /Z7 vs /Zi) ===
if(MSVC)
  target_compile_options(BoltCore PRIVATE /Zi)
endif()

# === Vendor-Libraries linken (pragmatisch) ===
link_directories("${CMAKE_SOURCE_DIR}/Vendor/External/Library")
file(GLOB EXTERNAL_LIBS "${CMAKE_SOURCE_DIR}/Vendor/External/Library/*.lib")
target_link_libraries(BoltCore PUBLIC ${EXTERNAL_LIBS})

# === FILE_SET für Headers → bessere IDE-Darstellung & install() ===
target_sources(BoltCore
  PUBLIC
    FILE_SET HEADERS
    BASE_DIRS ${CMAKE_CURRENT_SOURCE_DIR}/include
    FILES     ${CORE_HEADERS}
)

# === IDE-Ordnerstruktur verschönern (Source Groups) ===
source_group(TREE ${CMAKE_CURRENT_SOURCE_DIR}/include FILES ${CORE_HEADERS})
source_group(TREE ${CMAKE_CURRENT_SOURCE_DIR}/src     FILES ${CORE_SRCS})

# === Install-Regeln (optional) ===
install(TARGETS BoltCore
  EXPORT BoltCoreTargets
  ARCHIVE DESTINATION lib
  LIBRARY DESTINATION lib
  FILE_SET HEADERS DESTINATION include
)
install(EXPORT BoltCoreTargets
  FILE BoltCoreConfig.cmake
  NAMESPACE BoltCore::
  DESTINATION lib/cmake/BoltCore
)
install(DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}/include/ DESTINATION include)
